<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>babyfood</title>
  <style>
    fieldset {
      height: 142px;
    }

    ul {
      padding: 0;
    }

    li {
      list-style: none;
      display: flex;
      height: 30px;
    }

    li>p {
      width: 100px;
      margin: 0;
      font-size: 14px;
    }

    #wrapper {
      display: flex;
    }

    .list_title {
      border-bottom: solid black 1px;
    }
  </style>
</head>

<body>
  <h1>é›¢ä¹³é£Ÿåœ¨åº«ç®¡ç†</h1>
  <!-- å…¥åŠ›å ´æ‰€ã‚’ä½œæˆã—ã‚ˆã† -->
  <div id="wrapper">
    <div>
      <form>
        <fieldset>
          <legend>ãƒ“ã‚¿ãƒŸãƒ³ãƒ»ãƒŸãƒãƒ©ãƒ«</legend>
          <div>
            é£Ÿæ: <input type="text" id="food_b">
          </div>
          <div>
            å†·å‡ã—ãŸæ—¥: <input type="date" id="frozen_day_b">
          </div>
          <div>
            å†·è”µã—ãŸæ—¥: <input type="date" id="cold_day_b">
          </div>
          <div>
            <button type="button" id="save_b">è¨˜éŒ²ã™ã‚‹</button>
          </div>
        </fieldset>
      </form>
      <li class="list_title">
        <p>é£Ÿæ</p>
        <p>å†·å‡ã—ãŸæ—¥</p>
        <p>å†·è”µã—ãŸæ—¥</p>
      </li>
      <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
      <ul id="output_b"></ul>
    </div>
    <div>
      <form>
        <fieldset>
          <legend>ã‚¨ãƒãƒ«ã‚®ãƒ¼</legend>
          <div>
            é£Ÿæ: <input type="text" id="food_e">
          </div>
          <div>
            å†·å‡ã—ãŸæ—¥: <input type="date" id="frozen_day_e">
          </div>
          <div>
            å†·è”µã—ãŸæ—¥: <input type="date" id="cold_day_e">
          </div>
          <div>
            <button type="button" id="save_e">è¨˜éŒ²ã™ã‚‹</button>
          </div>
        </fieldset>
      </form>
      <li class="list_title">
        <p>é£Ÿæ</p>
        <p>å†·å‡ã—ãŸæ—¥</p>
        <p>å†·è”µã—ãŸæ—¥</p>
      </li>
      <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
      <ul id="output_e"></ul>
    </div>

    <div>
      <form>
        <fieldset>
          <legend>ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</legend>
          <div>
            é£Ÿæ: <input type="text" id="food_p">
          </div>
          <div>
            å†·å‡ã—ãŸæ—¥: <input type="date" id="frozen_day_p">
          </div>
          <div>
            å†·è”µã—ãŸæ—¥: <input type="date" id="cold_day_p">
          </div>
          <div>
            <button type="button" id="save_p">è¨˜éŒ²ã™ã‚‹</button>
          </div>
        </fieldset>
      </form>
      <li class="list_title">
        <p>é£Ÿæ</p>
        <p>å†·å‡ã—ãŸæ—¥</p>
        <p>å†·è”µã—ãŸæ—¥</p>
      </li>
      <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
      <ul id="output_p"></ul>
    </div>
    <div>
      <form>
        <fieldset>
          <legend>é£Ÿã¹ãŸã‚ˆï¼</legend>
          <div>
            é£Ÿæ: <input type="text" id="food">
          </div>
          <div>
            æ „é¤Š: <select name="nutrient" id="nutrient">
              <option value="">ã²ã¨ã¤é¸æŠ</option>
              <option value="energy">ã‚¨ãƒãƒ«ã‚®ãƒ¼</option>
              <option value="protein">ã‚¿ãƒ³ãƒ‘ã‚¯è³ª</option>
              <option value="bitamin">ãƒ“ã‚¿ãƒŸãƒ³ãƒ»ãƒŸãƒãƒ©ãƒ«</option>
            </select>
          </div>
          <div>
            åˆã‚ã¦é£Ÿã¹ãŸæ—¥: <input type="date" id="first_day">
          </div>
          <div>
            <button type="button" id="save">è¨˜éŒ²ã™ã‚‹</button>
          </div>
        </fieldset>
      </form>
      <li class="list_title">
        <p>é£Ÿæ</p>
        <p>æ „é¤Š</p>
        <p>åˆã‚ã¦é£Ÿã¹ãŸæ—¥</p>
      </li>
      <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
      <ul id="output"></ul>
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script>
    // æ—¥æ™‚ã‚’ã„ã„æ„Ÿã˜ã®å½¢å¼ã«ã™ã‚‹é–¢æ•°
    function convertTimestampToDatetime(timestamp) {
      const _d = timestamp ? new Date(timestamp * 1000) : new Date();
      const Y = _d.getFullYear();
      const m = (_d.getMonth() + 1).toString().padStart(2, '0');
      const d = _d.getDate().toString().padStart(2, '0');
      const H = _d.getHours().toString().padStart(2, '0');
      const i = _d.getMinutes().toString().padStart(2, '0');
      const s = _d.getSeconds().toString().padStart(2, '0');
      return `${Y}/${m}/${d} ${H}:${i}:${s}`;
    }
  </script>
  <!-- ä»¥ä¸‹ã«firebaseã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚ˆã† -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // ğŸ”½ è¿½åŠ  / `9.2.0`ã®éƒ¨åˆ†ã‚’â†‘ã®Firestoreã‹ã‚‰è²¼ã‚Šä»˜ã‘ãŸã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp,
      query,
      orderBy,
      onSnapshot,
    } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "", //æ‰±ã„æ³¨æ„ï¼ï¼ï¼
      authDomain: "babyfood-e0cc5.firebaseapp.com",
      projectId: "babyfood-e0cc5",
      storageBucket: "babyfood-e0cc5.appspot.com",
      messagingSenderId: "497819793963",
      appId: "1:497819793963:web:a6fbf21e43eb60ac14886e"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    const db = getFirestore(app);

    //ãƒ“ã‚¿ãƒŸãƒ³ãƒ»ãƒŸãƒãƒ©ãƒ«ã®ä¿å­˜ãƒœã‚¿ãƒ³
    $('#save_b').on('click', function () {
      const postData_b = {
        food_b: $('#food_b').val(),
        frozen_day_b: $('#frozen_day_b').val(),
        cold_day_b: $('#cold_day_b').val(),
        time: serverTimestamp(),
      };
      addDoc(collection(db, "food_list_b"), postData_b);
      $('#food_b').val('');
      $('#frozen_day_b').val('');
      $('#cold_day_b').val('');
    });
    //ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ä¿å­˜ãƒœã‚¿ãƒ³
    $('#save_e').on('click', function () {
      const postData_e = {
        food_e: $('#food_e').val(),
        frozen_day_e: $('#frozen_day_e').val(),
        cold_day_e: $('#cold_day_e').val(),
        time: serverTimestamp(),
      };
      addDoc(collection(db, "food_list_e"), postData_e);
      $('#food_e').val('');
      $('#frozen_day_e').val('');
      $('#cold_day_e').val('');
    });
    //ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®ä¿å­˜ãƒœã‚¿ãƒ³
    $('#save_p').on('click', function () {
      const postData_p = {
        food_p: $('#food_p').val(),
        frozen_day_p: $('#frozen_day_p').val(),
        cold_day_p: $('#cold_day_p').val(),
        time: serverTimestamp(),
      };
      addDoc(collection(db, "food_list_p"), postData_p);
      $('#food_p').val('');
      $('#frozen_day_p').val('');
      $('#cold_day_p').val('');
    });
    //é£Ÿã¹ãŸã‚ˆä¿å­˜ãƒœã‚¿ãƒ³
    $('#save').on('click', function () {
      const postData = {
        food: $('#food').val(),
        nutrient: $('#nutrient').val(),
        first_day: $('#first_day').val(),
        time: serverTimestamp(),
      };
      addDoc(collection(db, "food_list"), postData);
      $('#food').val('');
    });

    //order by
    const q_b = query(collection(db, "food_list_b"), orderBy("food_b", "asc"));
    const q_e = query(collection(db, "food_list_e"), orderBy("food_e", "asc"));
    const q_p = query(collection(db, "food_list_p"), orderBy("food_p", "asc"));
    const q = query(collection(db, "food_list"), orderBy("nutrient", "asc"));


    // chatapp.html
    // å‰é …ã®`console.log()`ä¸‹ã«è¨˜è¿°

    //ãƒ“ã‚¿ãƒŸãƒ³ã®å‡¦ç† 
    onSnapshot(q_b, (querySnapshot) => {
      console.log(querySnapshot.docs);
      const documents_b = [];
      querySnapshot.docs.forEach(function (doc_b) {
        const document_b = {
          id: doc_b.id,
          data: doc_b.data(),
        };
        documents_b.push(document_b);
      });
      console.log(documents_b);
      const htmlElements_b = [];
      documents_b.forEach(function (document_b) {
        htmlElements_b.push(`
    <li id="${document_b.id}">
      <p>${document_b.data.food_b}</p>
      <p>${document_b.data.frozen_day_b}</p>
      <p>${document_b.data.cold_day_b}</p>
      <button type="button" id="delete_b">å‰Šé™¤</button>
    </li>
  `);
      });
      $("#output_b").html(htmlElements_b);
    });
    /////////////////////////ã“ã“ã‹ã‚‰å·¥äº‹ä¸­/////////////////////////
    // //ãƒ“ã‚¿ãƒŸãƒ³ãƒ»ãƒŸãƒãƒ©ãƒ«ã®å‰Šé™¤ãƒœã‚¿ãƒ³ 
    // $('#delete_b').on('click', function () {
    //   let ref = firebase.database().ref(`babyfood/food_list_b/`);
    //   console.log(ref);
    //   let removeDatas_b = {
    //     id: removeId,
    //     food_b: removeFood_b,
    //     frozen_day: removeFrozenday,
    //     cold_day: removeColdday
    //   };
    //   ref.once('value', ss => {
    //     ss.forEach(function (v) {
    //       if (v.val().id == removedId) {
    //         console.log(v.ref.remove());
    //       };
    //     });
    //   });
    // });
    /////////////////////////ã“ã“ã¾ã§å·¥äº‹ä¸­/////////////////////////
    //ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®å‡¦ç† 
    onSnapshot(q_e, (querySnapshot) => {
      console.log(querySnapshot.docs);
      const documents_e = [];
      querySnapshot.docs.forEach(function (doc_e) {
        const document_e = {
          id: doc_e.id,
          data: doc_e.data(),
        };
        documents_e.push(document_e);
      });
      //console.log(documents_e);
      const htmlElements_e = [];
      documents_e.forEach(function (document_e) {
        htmlElements_e.push(`
    <li id="${document_e.id}">
      <p>${document_e.data.food_e}</p>
      <p>${document_e.data.frozen_day_e}</p>
      <p>${document_e.data.cold_day_e}</p>
      <button type="button" id="delete_e">å‰Šé™¤</button>
    </li>
  `);
      });
      $("#output_e").html(htmlElements_e);
    });
    //ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®å‡¦ç† 
    onSnapshot(q_p, (querySnapshot) => {
      console.log(querySnapshot.docs);
      const documents_p = [];
      querySnapshot.docs.forEach(function (doc_p) {
        const document_p = {
          id: doc_p.id,
          data: doc_p.data(),
        };
        documents_p.push(document_p);
      });
      //console.log(documents_p);
      const htmlElements_p = [];
      documents_p.forEach(function (document_p) {
        htmlElements_p.push(`
    <li id="${document_p.id}">
      <p>${document_p.data.food_p}</p>
      <p>${document_p.data.frozen_day_p}</p>
      <p>${document_p.data.cold_day_p}</p>
      <button type="button" id="delete_p">å‰Šé™¤</button>
    </li>
  `);
      });
      $("#output_p").html(htmlElements_p);
    });

    //é£Ÿã¹ãŸã‚ˆã®å‡¦ç†
    onSnapshot(q, (querySnapshot) => {
      console.log(querySnapshot.docs);
      const documents = [];
      querySnapshot.docs.forEach(function (doc) {
        const document = {
          id: doc.id,
          data: doc.data(),
        };
        documents.push(document);
      });
      //console.log(documents);
      const htmlElements = [];
      documents.forEach(function (document) {
        htmlElements.push(`
    <li id="${document.id}">
      <p>${document.data.food}</p>
      <p>${document.data.nutrient}</p>
      <p>${document.data.first_day}</p>
    </li>
  `);
      });

      $("#output").html(htmlElements);
    });


  </script>

</body>

</html>